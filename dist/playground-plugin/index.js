import{fileURLToPath as w}from"url";import{Hono as v}from"hono";import{serveStatic as p}from"@hono/node-server/serve-static";import i from"nunjucks";import h from"fs";import o from"path";import k from"js-yaml";import _ from"markdown-it";import R from"markdown-it-anchor";import g from"highlight.js/lib/common";var S=w(import.meta.url),d=o.dirname(S);function E(j,f){let r=new v,m;return i.configure(o.join(d,"templates"),{autoescape:!0,watch:!1,noCache:!0}),r.use("/css/*",p({root:o.join(d,"templates")})),r.use("/js/*",p({root:o.join(d,"templates")})),r.use("/assets/*",p({root:o.join(d,"templates")})),r.use("/favicon.png",p({path:o.join(d,"templates/favicon.png")})),r.get("/prerender",async t=>{let e="";if(f.VITE_BACKEND_URL)try{e=await(await fetch(`${f.VITE_BACKEND_URL}/api/prerender`)).text()}catch(s){e=s.message}else e="<h2>No prerender URL provided!(url/api/prerender)</h2>";let n=i.render("./pages/prerender.njk",{manifest:m,prerender:e});return t.html(n)}),r.get("/demo",t=>{let e=i.render("./pages/demo.njk",{manifest:m});return t.html(e)}),r.get("/documentation",t=>{let e=_({highlight:function(l,c){if(c&&g.getLanguage(c))try{return'<pre><code class="hljs">'+g.highlight(l,{language:c,ignoreIllegals:!0}).value+"</code></pre>"}catch{}return'<pre><code class="hljs">'+e.utils.escapeHtml(l)+"</code></pre>"}});e.use(R);let n=o.resolve(`${j}/openmfe/index.md`),s=h.readFileSync(n,"utf8"),u=e.render(s),a=i.render("./pages/docs.njk",{text:u,manifest:m});return t.html(a)}),r.get("/",t=>{let e=i.render("./pages/landing.njk",{manifest:m});return t.html(e)}),{name:"vite:playground-serve",async buildStart(){let t=o.resolve(process.cwd(),"src/manifest.yaml"),e=h.readFileSync(t,"utf8");m=k.load(e,"utf8")},configureServer(t){t.middlewares.use(async(e,n,s)=>{let u=new Request(`http://localhost${e.url}`,{method:e.method,headers:e.headers}),a=await r.fetch(u);if(!a.ok){s();return}n.statusCode=a.status,a.headers.forEach((c,y)=>{n.setHeader(y,c)});let l=await a.arrayBuffer();n.end(Buffer.from(l))})}}}export{E as default};
//# sourceMappingURL=index.js.map
