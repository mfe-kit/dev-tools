import{fileURLToPath as y}from"url";import{Hono as _}from"hono";import{serveStatic as u}from"@hono/node-server/serve-static";import i from"nunjucks";import f from"fs";import a from"path";import v from"js-yaml";import k from"markdown-it";import E from"markdown-it-anchor";import g from"highlight.js/lib/common";var R=y(import.meta.url),l=a.dirname(R);function S(w,d){let r=new _,n;return i.configure(a.join(l,"templates"),{autoescape:!0,watch:!1,noCache:!0}),r.use("/css/*",u({root:a.join(l,"templates")})),r.use("/js/*",u({root:a.join(l,"templates")})),r.use("/assets/*",u({root:a.join(l,"templates")})),r.use("/favicon.png",u({path:a.join(l,"templates/favicon.png")})),r.get("/prerender",async t=>{let e="";if(d.VITE_BACKEND_URL)try{e=await(await fetch(`${d.VITE_BACKEND_URL}/api/prerender`)).text()}catch(s){e=s.message}else e="<h2>No prerender URL provided!(url/api/prerender)</h2>";let o=i.render("./pages/ssr.njk",{manifest:n,data:e});return t.html(o)}),r.get("/ssr",async t=>{let e="";if(d.VITE_BACKEND_URL)try{e=await(await fetch(`${d.VITE_BACKEND_URL}/api/ssr`+window.location.search)).text()}catch(s){e=s.message}else e="<h2>No prerender SSR provided!(url/api/ssr)</h2>";let o=i.render("./pages/ssr.njk",{manifest:n,data:e});return t.html(o)}),r.get("/demo",t=>{let e=i.render("./pages/demo.njk",{manifest:n});return t.html(e)}),r.get("/documentation",t=>{let e=k({highlight:function(p,m){if(m&&g.getLanguage(m))try{return'<pre><code class="hljs">'+g.highlight(p,{language:m,ignoreIllegals:!0}).value+"</code></pre>"}catch{}return'<pre><code class="hljs">'+e.utils.escapeHtml(p)+"</code></pre>"}});e.use(E);let o=a.resolve(`${w}/openmfe/index.md`),s=f.readFileSync(o,"utf8"),h=e.render(s),c=i.render("./pages/docs.njk",{text:h,manifest:n});return t.html(c)}),r.get("/",t=>{let e=i.render("./pages/landing.njk",{manifest:n});return t.html(e)}),{name:"vite:playground-serve",async buildStart(){let t=a.resolve(process.cwd(),"src/manifest.yaml"),e=f.readFileSync(t,"utf8");n=v.load(e,"utf8")},configureServer(t){t.middlewares.use(async(e,o,s)=>{let h=new Request(`http://localhost${e.url}`,{method:e.method,headers:e.headers}),c=await r.fetch(h);if(!c.ok){s();return}o.statusCode=c.status,c.headers.forEach((m,j)=>{o.setHeader(j,m)});let p=await c.arrayBuffer();o.end(Buffer.from(p))})}}}export{S as default};
//# sourceMappingURL=index.js.map
