{
  "version": 3,
  "sources": ["../../src/playground-plugin/index.js"],
  "sourcesContent": ["import { fileURLToPath } from 'url';\nimport { Hono } from 'hono';\nimport { serveStatic } from '@hono/node-server/serve-static';\nimport nunjucks from 'nunjucks';\nimport fs from 'fs';\nimport path from 'path';\nimport yaml from 'js-yaml';\nimport MarkdownIt from 'markdown-it';\nimport markdownItAnchor from 'markdown-it-anchor';\nimport hljs from 'highlight.js/lib/common';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nexport default function playgroundServe(root, env) {\n  const app = new Hono();\n  let manifest;\n\n  nunjucks.configure(path.join(__dirname, 'templates'), {\n    autoescape: true,\n    watch: false,\n    noCache: true,\n  });\n\n  app.use('/css/*', serveStatic({ root: path.join(__dirname, 'templates') }));\n  app.use('/js/*', serveStatic({ root: path.join(__dirname, 'templates') }));\n  app.use(\n    '/assets/*',\n    serveStatic({ root: path.join(__dirname, 'templates') }),\n  );\n  app.use(\n    '/favicon.png',\n    serveStatic({ path: path.join(__dirname, 'templates/favicon.png') }),\n  );\n\n  app.get('/prerender', async (c) => {\n    let prerender = '';\n    if (env.VITE_BACKEND_URL) {\n      try {\n        const result = await fetch(`${env.VITE_BACKEND_URL}/api/prerender`);\n        prerender = await result.text();\n      } catch (e) {\n        prerender = e.message;\n      }\n    } else {\n      prerender = '<h2>No prerender URL provided!(url/api/prerender)</h2>';\n    }\n    const html = nunjucks.render('./pages/prerender.njk', {\n      manifest,\n      prerender,\n    });\n    return c.html(html);\n  });\n  app.get('/demo', (c) => {\n    const html = nunjucks.render('./pages/demo.njk', { manifest });\n    return c.html(html);\n  });\n  app.get('/documentation', (c) => {\n    const md = MarkdownIt({\n      highlight: function (str, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n          try {\n            return (\n              '<pre><code class=\"hljs\">' +\n              hljs.highlight(str, { language: lang, ignoreIllegals: true })\n                .value +\n              '</code></pre>'\n            );\n          } catch {\n            void 0;\n          }\n        }\n        return (\n          '<pre><code class=\"hljs\">' +\n          md.utils.escapeHtml(str) +\n          '</code></pre>'\n        );\n      },\n    });\n    md.use(markdownItAnchor);\n    const mdPath = path.resolve(`${root}/openmfe/index.md`);\n    const mdRaw = fs.readFileSync(mdPath, 'utf8');\n    const text = md.render(mdRaw);\n    const html = nunjucks.render('./pages/docs.njk', { text, manifest });\n    return c.html(html);\n  });\n  app.get('/', (c) => {\n    const html = nunjucks.render('./pages/landing.njk', { manifest });\n    return c.html(html);\n  });\n\n  return {\n    name: 'vite:playground-serve',\n    async buildStart() {\n      const manifestPath = path.resolve(process.cwd(), 'src/manifest.yaml');\n      const content = fs.readFileSync(manifestPath, 'utf8');\n      manifest = yaml.load(content, 'utf8');\n    },\n    configureServer(server) {\n      server.middlewares.use(async (req, res, next) => {\n        const request = new Request(`http://localhost${req.url}`, {\n          method: req.method,\n          headers: req.headers,\n        });\n        const response = await app.fetch(request);\n        if (!response.ok) {\n          next();\n          return;\n        }\n        res.statusCode = response.status;\n        response.headers.forEach((value, key) => {\n          res.setHeader(key, value);\n        });\n        const body = await response.arrayBuffer();\n        res.end(Buffer.from(body));\n      });\n    },\n  };\n}\n"],
  "mappings": "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",
  "names": ["fileURLToPath", "Hono", "serveStatic", "nunjucks", "fs", "path", "yaml", "MarkdownIt", "markdownItAnchor", "hljs", "__filename", "__dirname", "playgroundServe", "root", "env", "app", "manifest", "c", "prerender", "e", "html", "md", "str", "lang", "mdPath", "mdRaw", "text", "manifestPath", "content", "server", "req", "res", "next", "request", "response", "value", "key", "body"]
}
